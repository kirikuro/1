syntax = "proto3";

import "proto/insonmnia.proto";

package sonm;

service Hub {
    // Ping checks Hub availability for user
    rpc Ping (PingRequest) returns (PingReply) {}
    // Status return Hub status
    rpc Status (HubStatusRequest) returns (HubStatusReply) {}

    // MinerList returns Miners connected to Hub
    rpc MinerList (MinerListRequest) returns (MinerListReply) {}
    // MinerInfo returns detailed info about conected Miner
    rpc MinerInfo (MinerInfoRequest) returns (MinerStatusReply) {}

    // TaskXXX forward task operations to given Miner
    rpc TaskStart (HubStartTaskRequest) returns (HubStartTaskReply) {}
    rpc TaskStop (TaskStopRequest) returns (TaskStopReply) {}
    rpc TaskStatus (TaskDetailsRequest) returns (TaskDetailsReply) {}
    rpc TaskList (HubTaskListMapRequest) returns (TaskDetailsMapReply) {}
    rpc TaskLogs (TaskLogsRequest) returns (stream TaskLogsChunk) {}
}

message MinerListRequest {
}

message MinerListReply {
    message ListValue {
        repeated string values = 1;
    }
    map<string, ListValue> info = 1;
}

message MinerInfoRequest {
    string miner = 1;
}

message HubStartTaskRequest {
    string miner = 1;
    string registry = 2;
    string image = 3;
    string auth = 4;
    string PublicKeyData = 5;
}

message HubStartTaskReply {
    string id = 1;
    repeated string endpoint = 2;
}

message HubTaskListMapRequest {
    string miner = 1;
}

message HubStatusRequest {}

message HubStatusReply {
    uint64 minerCount = 1;
    uint64 uptime = 2;
}
